

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>GEL models documentation &mdash; GEL models 6.0.0 documentation</title>
  

  
  
  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="GEL models 6.0.0 documentation" href="#"/>
        <link rel="next" title="GEL Models documentation" href="models.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="#" class="icon icon-home"> GEL models
          

          
          </a>

          
            
            
              <div class="version">
                6.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">GEL models documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#packages">Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#main-functionalities">Main functionalities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resources">Resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#models-documentation">Models Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="models.html">GEL Models documentation</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-built-version-from-pypip">Install built version from PyPIP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#or-build-locally">Or build locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-the-models">Build the models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#building-legacy-versions-of-the-models">Building legacy versions of the models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-custom-tools-to-build-the-models">Using custom tools to build the models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-build-options">Other build options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#java-packaging">Java Packaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unit-tests">Unit tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#serialisation-to-from-json">Serialisation to/from JSON</a></li>
<li class="toctree-l3"><a class="reference internal" href="#serialisation-to-from-avro">Serialisation to/from AVRO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#schema-validation">Schema validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mock-data">Mock data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#migrations">Migrations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-resources-from-a-container">Building Resources From a Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-tools">Additional tools</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="models.html">GEL Models documentation</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">GEL models</a>
        
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="#">Docs</a> &raquo;</li>
        
      <li>GEL models documentation</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/index.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="gel-models-documentation">
<h1>GEL models documentation<a class="headerlink" href="#gel-models-documentation" title="Permalink to this headline">¶</a></h1>
<div class="toctree-wrapper compound">
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">GEL models documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#packages">Packages</a></li>
<li class="toctree-l3"><a class="reference internal" href="#main-functionalities">Main functionalities</a></li>
<li class="toctree-l3"><a class="reference internal" href="#resources">Resources</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#models-documentation">Models Documentation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="models.html">GEL Models documentation</a><ul>
<li class="toctree-l4"><a class="reference internal" href="models.html#org-gel-models-metrics-avro">org.gel.models.metrics.avro</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#org-gel-models-coverage-avro">org.gel.models.coverage.avro</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#org-opencb-biodata-models-variant-avro">org.opencb.biodata.models.variant.avro</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#org-gel-models-participant-avro">org.gel.models.participant.avro</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#org-ga4gh-models">org.ga4gh.models</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#gel-bioinf-models">Gel_BioInf_Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#org-gel-models-system-avro">org.gel.models.system.avro</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#org-gel-models-cva-avro">org.gel.models.cva.avro</a></li>
<li class="toctree-l4"><a class="reference internal" href="models.html#org-gel-models-report-avro">org.gel.models.report.avro</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#install-built-version-from-pypip">Install built version from PyPIP</a></li>
<li class="toctree-l3"><a class="reference internal" href="#or-build-locally">Or build locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="#build-the-models">Build the models</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#building-legacy-versions-of-the-models">Building legacy versions of the models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#using-custom-tools-to-build-the-models">Using custom tools to build the models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#other-build-options">Other build options</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#java-packaging">Java Packaging</a></li>
<li class="toctree-l3"><a class="reference internal" href="#unit-tests">Unit tests</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#getting-started">Getting started</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#serialisation-to-from-json">Serialisation to/from JSON</a></li>
<li class="toctree-l3"><a class="reference internal" href="#serialisation-to-from-avro">Serialisation to/from AVRO</a></li>
<li class="toctree-l3"><a class="reference internal" href="#schema-validation">Schema validation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#mock-data">Mock data</a></li>
<li class="toctree-l3"><a class="reference internal" href="#migrations">Migrations</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-resources-from-a-container">Building Resources From a Container</a></li>
<li class="toctree-l3"><a class="reference internal" href="#additional-tools">Additional tools</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>GEL models project contains the data models that aim at standardizing data exchanges with Genomics England systems either internally or externally. This enables our data exchanges to be programming language and technology-agnostic.</p>
<p>Two illustrative examples:</p>
<ul class="simple">
<li>The CIPAPI exchanges data with the CIPs based on these models. This allows the CIPAPI to be completely independent of the specific implementations in the CIPs.</li>
<li>The CIPAPI pushes data to CVA. While the CIPAPI is implemented as a Django application in Python, CVA is a Java application deployed in Tomcat.</li>
</ul>
<p>The above exchanges are based on a REST interface, but any other technology could be used.</p>
<p>We use Avro to describe our models.</p>
<div class="section" id="packages">
<h3>Packages<a class="headerlink" href="#packages" title="Permalink to this headline">¶</a></h3>
<p>The models are organised in packages:</p>
<ul class="simple">
<li>Participants: Demographic and Clinical Information</li>
<li>Reports: Interpretation Request, Interpreted Genome, Clinical Reports</li>
<li>Metrics: errr…. Metrics, yes</li>
<li>Cva: Reported Variants and its Evidences</li>
<li>Ga4gh: External. Variants and Alignments</li>
<li>OpenCB: External(ish). Variants and Variant Annotation (and recently also evidences)</li>
</ul>
</div>
<div class="section" id="main-functionalities">
<h3>Main functionalities<a class="headerlink" href="#main-functionalities" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Automatic code generation to hold the data (Python and Java supported out-of-the-box; others as C, C++ and C# are supported by ad hoc avro libraries).</li>
<li>Enable data validation against a schema (see the validation service <cite>https://github.com/genomicsengland/data-validation &lt;https://github.com/genomicsengland/data-validation&gt;</cite> for additional validation business rules)</li>
<li>Data serialisation/deserialisation to/from JSON</li>
<li>Generation of mocked data</li>
<li>Documentation automatically generated from the models</li>
</ul>
</div>
<div class="section" id="resources">
<h3>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li>Github repository: <cite>https://github.com/genomicsengland/GelReportModels &lt;https://github.com/genomicsengland/GelReportModels&gt;</cite></li>
<li>Models documentation: <cite>https://genomicsengland.github.io/GelReportModels &lt;https://genomicsengland.github.io/GelReportModels&gt;</cite></li>
</ul>
</div>
</div>
<div class="section" id="models-documentation">
<h2>Models Documentation<a class="headerlink" href="#models-documentation" title="Permalink to this headline">¶</a></h2>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="models.html">GEL Models documentation</a><ul>
<li class="toctree-l2"><a class="reference internal" href="models.html#org-gel-models-metrics-avro">org.gel.models.metrics.avro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="models.html#id1">1.2.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id2">1.0.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id3">1.1.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id4">1.0.1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="models.html#org-gel-models-coverage-avro">org.gel.models.coverage.avro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="models.html#id5">0.1.0</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="models.html#org-opencb-biodata-models-variant-avro">org.opencb.biodata.models.variant.avro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="models.html#id6">1.2.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#snapshot">1.3.0-SNAPSHOT</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id7">1.3.0</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="models.html#org-gel-models-participant-avro">org.gel.models.participant.avro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="models.html#id8">1.1.1</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id9">1.0.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id10">1.0.3</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id11">1.1.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id12">1.0.1</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="models.html#org-ga4gh-models">org.ga4gh.models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="models.html#id13">3.0.0</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="models.html#gel-bioinf-models">Gel_BioInf_Models</a><ul>
<li class="toctree-l3"><a class="reference internal" href="models.html#id14">2.1.0</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="models.html#org-gel-models-system-avro">org.gel.models.system.avro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="models.html#id15">0.1.0</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="models.html#org-gel-models-cva-avro">org.gel.models.cva.avro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="models.html#id16">1.0.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id17">0.4.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id18">1.1.0</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="models.html#org-gel-models-report-avro">org.gel.models.report.avro</a><ul>
<li class="toctree-l3"><a class="reference internal" href="models.html#id19">5.0.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id20">4.2.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id21">6.0.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id22">4.0.0</a></li>
<li class="toctree-l3"><a class="reference internal" href="models.html#id23">3.0.0</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class="section" id="installation">
<h2>Installation<a class="headerlink" href="#installation" title="Permalink to this headline">¶</a></h2>
<div class="section" id="install-built-version-from-pypip">
<h3>Install built version from PyPIP<a class="headerlink" href="#install-built-version-from-pypip" title="Permalink to this headline">¶</a></h3>
<p>Install from pip:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>pip install -i $PIP_SERVER GelReportModels
</pre></div>
</div>
</div>
<div class="section" id="or-build-locally">
<h3>Or build locally<a class="headerlink" href="#or-build-locally" title="Permalink to this headline">¶</a></h3>
<p>Install <code class="docutils literal"><span class="pre">sphynx</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">python</span><span class="o">-</span><span class="n">sphinx</span>
</pre></div>
</div>
<p>Install <code class="docutils literal"><span class="pre">avrodoc</span></code>:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">nodejs</span> <span class="n">nodejs</span><span class="o">-</span><span class="n">legacy</span>
<span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">npm</span>
<span class="n">sudo</span> <span class="n">npm</span> <span class="n">install</span> <span class="n">avrodoc</span> <span class="o">-</span><span class="n">g</span>
</pre></div>
</div>
<p>Install python dependencies:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">r</span> <span class="n">requirements</span><span class="o">.</span><span class="n">txt</span>
</pre></div>
</div>
</div>
<div class="section" id="build-the-models">
<h3>Build the models<a class="headerlink" href="#build-the-models" title="Permalink to this headline">¶</a></h3>
<p>To build all builds described in <code class="docutils literal"><span class="pre">builds.json</span></code> run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">build</span><span class="o">.</span><span class="n">py</span>
</pre></div>
</div>
<p>This will create the following:
* Python source code representing the Avro records in the folder <code class="docutils literal"><span class="pre">./protocols/models</span></code>
* Java source code representing the Avro records in the folder <code class="docutils literal"><span class="pre">./target/generated-sources/avro</span></code>
* The models HTML documentation under <code class="docutils literal"><span class="pre">./docs/html_schemas</span></code></p>
<p>It may be handy to skip the documentation generation by using the flag <code class="docutils literal"><span class="pre">--skip-docs</span></code>.</p>
<p>NOTE: Java source code is only generated for the last build version, while Python source code is generated for all versions</p>
<div class="section" id="building-legacy-versions-of-the-models">
<h4>Building legacy versions of the models<a class="headerlink" href="#building-legacy-versions-of-the-models" title="Permalink to this headline">¶</a></h4>
<p>See <code class="docutils literal"><span class="pre">builds.json</span></code> for the information on all legacy versions and the specific package versions and dependencies in each of those.</p>
<p>To build a specific version run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">build</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">version</span> <span class="mf">3.0</span><span class="o">.</span><span class="mi">0</span>
</pre></div>
</div>
</div>
<div class="section" id="using-custom-tools-to-build-the-models">
<h4>Using custom tools to build the models<a class="headerlink" href="#using-custom-tools-to-build-the-models" title="Permalink to this headline">¶</a></h4>
<p>To facilitate using custom tools to build the models you can prepare the sandbox for a specific version running:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">build</span><span class="o">.</span><span class="n">py</span> <span class="o">--</span><span class="n">version</span> <span class="mf">4.0</span><span class="o">.</span><span class="mi">0</span> <span class="o">--</span><span class="n">only</span><span class="o">-</span><span class="n">prepare</span><span class="o">-</span><span class="n">sandbox</span>
</pre></div>
</div>
<p>This will copy all required schemas for that build under the folder <code class="docutils literal"><span class="pre">schemas/IDLs/build</span></code>.</p>
</div>
<div class="section" id="other-build-options">
<h4>Other build options<a class="headerlink" href="#other-build-options" title="Permalink to this headline">¶</a></h4>
<p>Use <code class="docutils literal"><span class="pre">--skip-docs</span></code> to avoid generating documentation which affects build time greatly.</p>
<p>Use <code class="docutils literal"><span class="pre">--skip-java</span></code> to avoid generating Java source code.</p>
<p>Use <code class="docutils literal"><span class="pre">--update-docs-index</span></code> to update the documentation landing page with the latest documentation generated.</p>
</div>
</div>
<div class="section" id="java-packaging">
<h3>Java Packaging<a class="headerlink" href="#java-packaging" title="Permalink to this headline">¶</a></h3>
<p>To pack the Java source code representing these models in a jar file use:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">mvn</span> <span class="n">package</span>
</pre></div>
</div>
<p>To install it in your system so it is accessible as a maven dependency to other Java applications run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="n">mvn</span> <span class="n">install</span>
</pre></div>
</div>
</div>
<div class="section" id="unit-tests">
<h3>Unit tests<a class="headerlink" href="#unit-tests" title="Permalink to this headline">¶</a></h3>
<p>To run some unit tests implemented in Python run:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">%</span> <span class="o">./</span><span class="n">run_tests</span><span class="o">.</span><span class="n">sh</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="getting-started">
<h2>Getting started<a class="headerlink" href="#getting-started" title="Permalink to this headline">¶</a></h2>
<div class="section" id="serialisation-to-from-json">
<h3>Serialisation to/from JSON<a class="headerlink" href="#serialisation-to-from-json" title="Permalink to this headline">¶</a></h3>
<p>Given that you hold your data in JSON format in a string in memory deserialise as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">protocols.reports_4_0_0</span> <span class="k">import</span> <span class="n">CancerInterpretationRequest</span> <span class="k">as</span> <span class="n">CancerInterpretationRequest_4_0_0</span>
<span class="n">instance</span> <span class="o">=</span> <span class="n">CancerInterpretationRequest_4_0_0</span><span class="o">.</span><span class="n">fromJsonString</span><span class="p">(</span><span class="n">json_string</span><span class="p">)</span>
<span class="c1"># now you can access the data in the instance</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;This interpretation request has </span><span class="si">{}</span><span class="s2"> variants&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">tieredVariants</span><span class="p">))</span>
</pre></div>
</div>
<p>If your data is hold in a Python dictionary in memory deserialise as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">instance</span> <span class="o">=</span> <span class="n">CancerInterpretationRequest_4_0_0</span><span class="o">.</span><span class="n">fromJsonDict</span><span class="p">(</span><span class="n">json_dict</span><span class="p">)</span>
</pre></div>
</div>
<p>The object can be serialised into JSON as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">instance</span><span class="o">.</span><span class="n">toJsonDict</span><span class="p">()</span>
<span class="n">instance</span><span class="o">.</span><span class="n">toJsonString</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="serialisation-to-from-avro">
<h3>Serialisation to/from AVRO<a class="headerlink" href="#serialisation-to-from-avro" title="Permalink to this headline">¶</a></h3>
<p>TODO</p>
</div>
<div class="section" id="schema-validation">
<h3>Schema validation<a class="headerlink" href="#schema-validation" title="Permalink to this headline">¶</a></h3>
<p>Validate any instance against the corresponding schema. This validation will ensure that all non-nullable fields are actually filled.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># just Avro native validation</span>
<span class="n">is_valid</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">toJsonDict</span><span class="p">())</span>

<span class="c1"># verbose validation</span>
<span class="n">validation_object</span> <span class="o">=</span> <span class="n">instance</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">instance</span><span class="o">.</span><span class="n">toJsonDict</span><span class="p">(),</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">is_valid</span> <span class="o">=</span> <span class="n">validation_object</span><span class="o">.</span><span class="n">result</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">is_valid</span>
    <span class="nb">print</span> <span class="n">validation_object</span><span class="o">.</span><span class="n">messages</span>
</pre></div>
</div>
</div>
<div class="section" id="mock-data">
<h3>Mock data<a class="headerlink" href="#mock-data" title="Permalink to this headline">¶</a></h3>
<p>Generate a mocked object or a batch of objects with custom fields as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">protocols.util.factories.avro_factory</span> <span class="k">import</span> <span class="n">GenericFactoryAvro</span>

<span class="c1"># gets a default factory of InterpretationRequestRD for reports package 5.0.0 included in build 6.0.0</span>
<span class="n">factory</span> <span class="o">=</span> <span class="n">GenericFactoryAvro</span><span class="o">.</span><span class="n">get_factory_avro</span><span class="p">(</span>
    <span class="n">protocols</span><span class="o">.</span><span class="n">reports_5_0_0</span><span class="o">.</span><span class="n">InterpretationRequestRD</span><span class="p">,</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;6.0.0&#39;</span>
<span class="p">)</span>
<span class="c1"># creates one mocked instance</span>
<span class="n">instance</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="c1"># creates a batch of mocked instances</span>
<span class="n">instances</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create_batch</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="c1"># creates an instance with one custom value</span>
<span class="n">instance_with_uri</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">analysisReturnUri</span> <span class="o">=</span> <span class="s2">&quot;myURI&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Get a factory that fills all nullable fields (nullable fields are not filled by default)</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># get an interpretation request RD for reports 4.2.0</span>
<span class="n">factory</span> <span class="o">=</span> <span class="n">GenericFactoryAvro</span><span class="o">.</span><span class="n">get_factory_avro</span><span class="p">(</span>
    <span class="n">protocols</span><span class="o">.</span><span class="n">reports_5_0_0</span><span class="o">.</span><span class="n">CancerInterpretedGenome</span><span class="p">,</span>
    <span class="n">version</span> <span class="o">=</span> <span class="s1">&#39;6.0.0&#39;</span><span class="p">,</span>
    <span class="n">fill_nullables</span><span class="o">=</span><span class="kc">True</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Generate custom factories as follows</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">protocols.ga4gh_3_0_0</span> <span class="k">import</span> <span class="n">Variant</span>
<span class="kn">from</span> <span class="nn">protocols.util.factories.avro_factory</span> <span class="k">import</span> <span class="n">FactoryAvro</span>


<span class="k">class</span> <span class="nc">GA4GHVariantFactory</span><span class="p">(</span><span class="n">FactoryAvro</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">GA4GHVariantFactory</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Variant</span>

    <span class="n">_version</span> <span class="o">=</span> <span class="s1">&#39;6.0.0&#39;</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">fuzzy</span><span class="o">.</span><span class="n">FuzzyInteger</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10000000</span><span class="p">)</span>
    <span class="n">referenceBases</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">fuzzy</span><span class="o">.</span><span class="n">FuzzyChoice</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">])</span>
    <span class="n">alternateBases</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">LazyAttribute</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">[</span><span class="n">factory</span><span class="o">.</span><span class="n">fuzzy</span><span class="o">.</span><span class="n">FuzzyChoice</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;T&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;G&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">fuzz</span><span class="p">()])</span>
    <span class="n">qual</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">fuzzy</span><span class="o">.</span><span class="n">FuzzyInteger</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">600</span><span class="p">)</span>
    <span class="n">referenceName</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">fuzzy</span><span class="o">.</span><span class="n">FuzzyChoice</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">23</span><span class="p">))</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">,</span> <span class="s1">&#39;MT&#39;</span><span class="p">]))</span>

<span class="n">factory</span> <span class="o">=</span> <span class="n">GA4GHVariantFactory</span>
<span class="n">variant</span> <span class="o">=</span> <span class="n">factory</span><span class="p">()</span>
<span class="n">variants</span> <span class="o">=</span> <span class="n">factory</span><span class="o">.</span><span class="n">create_batch</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="migrations">
<h3>Migrations<a class="headerlink" href="#migrations" title="Permalink to this headline">¶</a></h3>
<p>There a number of migration scripts in the package <cite>protocols.migration</cite>. They can be used as follows:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">protocols.reports_4_0_0</span> <span class="k">import</span> <span class="n">CancerInterpretationRequest</span> <span class="k">as</span> <span class="n">CancerInterpretationRequest_4_0_0</span>
<span class="kn">from</span> <span class="nn">protocols.reports_5_0_0</span> <span class="k">import</span> <span class="n">CancerInterpretationRequest</span> <span class="k">as</span> <span class="n">CancerInterpretationRequest_5_0_0</span>
<span class="kn">from</span> <span class="nn">protocols.util.dependency_manager</span> <span class="k">import</span> <span class="n">VERSION_400</span>
<span class="kn">from</span> <span class="nn">protocols.migration.migration_reports_4_0_0_to_reports_5_0_0</span> <span class="k">import</span> <span class="n">MigrateReports400To500</span>

<span class="n">old_instance</span> <span class="o">=</span> <span class="n">GenericFactoryAvro</span><span class="o">.</span><span class="n">get_factory_avro</span><span class="p">(</span><span class="n">CancerInterpretationRequest_4_0_0</span><span class="p">,</span> <span class="n">VERSION_400</span><span class="p">)</span><span class="o">.</span><span class="n">create</span><span class="p">()</span>
<span class="n">old_instance</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">old_instance</span><span class="o">.</span><span class="n">toJsonDict</span><span class="p">())</span>

<span class="n">migrated_instance</span> <span class="o">=</span> <span class="n">MigrateReports400To500</span><span class="p">()</span><span class="o">.</span><span class="n">migrate_cancer_interpretation_request</span><span class="p">(</span>
    <span class="n">old_instance</span><span class="o">=</span><span class="n">old_instance</span><span class="p">,</span> <span class="n">assembly</span><span class="o">=</span><span class="s1">&#39;GRCh38&#39;</span>
<span class="p">)</span>
<span class="n">migrated_instance</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span><span class="n">migrated_instance</span><span class="o">.</span><span class="n">toJsonDict</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="building-resources-from-a-container">
<h3>Building Resources From a Container<a class="headerlink" href="#building-resources-from-a-container" title="Permalink to this headline">¶</a></h3>
<p>From your starting directory, eg. ~/src/:</p>
<p>Clone this repo</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">git</span><span class="nd">@github</span><span class="o">.</span><span class="n">com</span><span class="p">:</span><span class="n">genomicsengland</span><span class="o">/</span><span class="n">GelReportModels</span><span class="o">.</span><span class="n">git</span>
</pre></div>
</div>
<p>Then run the following (you may need <cite>sudo</cite> depending on your system configuration):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">build_models</span>
</pre></div>
</div>
<p>Once the build is successful, check the resources are there:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@e444d27c16b9</span><span class="p">:</span><span class="o">/</span><span class="n">gel</span><span class="c1"># ls GelReportModels/protocols/</span>
<span class="n">GelProtocols</span><span class="o">.</span><span class="n">pyc</span>      <span class="n">cva_0_3_0</span><span class="o">.</span><span class="n">py</span>      <span class="n">migration</span>                 <span class="n">protocol</span><span class="o">.</span><span class="n">py</span>
<span class="fm">__init__</span><span class="o">.</span><span class="n">py</span>           <span class="n">ga4gh</span><span class="o">.</span><span class="n">py</span>          <span class="n">opencb</span><span class="o">.</span><span class="n">py</span>                 <span class="n">protocol</span><span class="o">.</span><span class="n">pyc</span>
<span class="fm">__init__</span><span class="o">.</span><span class="n">pyc</span>          <span class="n">ga4gh_3_0_0</span><span class="o">.</span><span class="n">py</span>    <span class="n">opencb_1_2_0</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">.</span><span class="n">py</span>  <span class="n">reports</span><span class="o">.</span><span class="n">py</span>
<span class="n">catalog_variable_set</span>  <span class="n">metrics</span><span class="o">.</span><span class="n">py</span>        <span class="n">participant</span><span class="o">.</span><span class="n">py</span>            <span class="n">reports_2_1_0</span><span class="o">.</span><span class="n">py</span>
<span class="n">cva</span><span class="o">.</span><span class="n">py</span>                <span class="n">metrics_1_0_0</span><span class="o">.</span><span class="n">py</span>  <span class="n">participant_1_0_0</span><span class="o">.</span><span class="n">py</span>      <span class="n">reports_3_0_0</span><span class="o">.</span><span class="n">py</span>
<span class="n">root</span><span class="nd">@e444d27c16b9</span><span class="p">:</span><span class="o">/</span><span class="n">gel</span><span class="c1">#</span>
</pre></div>
</div>
<p>Also check that Java resources are there:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@4dabae77118d</span><span class="p">:</span><span class="o">/</span><span class="n">gel</span><span class="c1"># ls -l GelReportModels/target/</span>
<span class="n">total</span> <span class="mi">53620</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span>     <span class="mi">4096</span> <span class="n">Aug</span> <span class="mi">18</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span> <span class="n">antrun</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">3</span> <span class="n">root</span> <span class="n">root</span>     <span class="mi">4096</span> <span class="n">Aug</span> <span class="mi">18</span> <span class="mi">08</span><span class="p">:</span><span class="mi">45</span> <span class="n">classes</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span>     <span class="mi">4096</span> <span class="n">Aug</span> <span class="mi">18</span> <span class="mi">08</span><span class="p">:</span><span class="mi">35</span> <span class="n">dependency</span><span class="o">-</span><span class="n">maven</span><span class="o">-</span><span class="n">plugin</span><span class="o">-</span><span class="n">markers</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span> <span class="mi">17</span> <span class="n">root</span> <span class="n">root</span>     <span class="mi">4096</span> <span class="n">Aug</span> <span class="mi">18</span> <span class="mi">08</span><span class="p">:</span><span class="mi">55</span> <span class="n">gel</span><span class="o">-</span><span class="n">models</span><span class="o">-</span><span class="mf">4.3</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">SNAPSHOT</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>  <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>  <span class="mi">1819234</span> <span class="n">Aug</span> <span class="mi">18</span> <span class="mi">08</span><span class="p">:</span><span class="mi">45</span> <span class="n">gel</span><span class="o">-</span><span class="n">models</span><span class="o">-</span><span class="mf">4.3</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">.</span><span class="n">jar</span>
<span class="o">-</span><span class="n">rw</span><span class="o">-</span><span class="n">r</span><span class="o">--</span><span class="n">r</span><span class="o">--</span>  <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span> <span class="mi">53054906</span> <span class="n">Aug</span> <span class="mi">18</span> <span class="mi">08</span><span class="p">:</span><span class="mi">55</span> <span class="n">gel</span><span class="o">-</span><span class="n">models</span><span class="o">-</span><span class="n">docs</span><span class="o">-</span><span class="mf">4.3</span><span class="o">.</span><span class="mi">0</span><span class="o">-</span><span class="n">SNAPSHOT</span><span class="o">.</span><span class="n">war</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">4</span> <span class="n">root</span> <span class="n">root</span>     <span class="mi">4096</span> <span class="n">Aug</span> <span class="mi">18</span> <span class="mi">08</span><span class="p">:</span><span class="mi">45</span> <span class="n">generated</span><span class="o">-</span><span class="n">sources</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">2</span> <span class="n">root</span> <span class="n">root</span>     <span class="mi">4096</span> <span class="n">Aug</span> <span class="mi">18</span> <span class="mi">08</span><span class="p">:</span><span class="mi">45</span> <span class="n">maven</span><span class="o">-</span><span class="n">archiver</span>
<span class="n">drwxr</span><span class="o">-</span><span class="n">xr</span><span class="o">-</span><span class="n">x</span>  <span class="mi">3</span> <span class="n">root</span> <span class="n">root</span>     <span class="mi">4096</span> <span class="n">Aug</span> <span class="mi">18</span> <span class="mi">08</span><span class="p">:</span><span class="mi">45</span> <span class="n">maven</span><span class="o">-</span><span class="n">status</span>
</pre></div>
</div>
<p>then in a separate tab/window, from the GelReportModels directory:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">ps</span> <span class="o">-</span><span class="n">alq</span> <span class="n">containerID</span>
</pre></div>
</div>
<p>and use this container ID to copy the python files from GelReportModels/protocols:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">docker</span> <span class="n">cp</span> <span class="n">containerID</span><span class="p">:</span><span class="o">/</span><span class="n">GelReportModels</span><span class="o">/</span><span class="n">protocols</span> <span class="o">.</span>
</pre></div>
</div>
<p>then check you have them present:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ ls ./protocols/
catalog_variable_set  GelProtocols.pyc  migration                 protocol.py
cva_0_3_0.py          __init__.py       opencb_1_2_0-SNAPSHOT.py  protocol.pyc
cva.py                __init__.pyc      opencb.py                 reports_2_1_0.py
ga4gh_3_0_0.py        metrics_1_0_0.py  participant_1_0_0.py      reports_3_0_0.py
ga4gh.py              metrics.py        participant.py            reports.py
</pre></div>
</div>
</div>
<div class="section" id="additional-tools">
<h3>Additional tools<a class="headerlink" href="#additional-tools" title="Permalink to this headline">¶</a></h3>
<p>The conversion between the different Avro schema formats, source code and documentation are available through the following script:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span>$ conversion_tools.py --help
usage: conversion_tools.py &lt;command&gt; [&lt;args&gt;]

GEL models toolbox

positional arguments:
  command     Subcommand to run
              (idl2json|idl2avpr|json2java|idl2python|json2python|avpr2html|update_docs_index)

optional arguments:
  -h, --help  show this help message and exit
</pre></div>
</div>
</div>
</div>
</div>


           </div>
           <div class="articleComments">
            
           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="models.html" class="btn btn-neutral float-right" title="GEL Models documentation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Antonio, Eik, Augusto, Alona, Matthew.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'6.0.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>